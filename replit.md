# Meet Up

## Overview
A full-stack web application (formerly Caminho Companion) that connects pilgrims on the Camino de Santiago, allowing them to share activities, transportation, meals, and accommodation during their journey. Built with React + Express + PostgreSQL. PWA with real Stripe payments, Web Push notifications, and multilingual support (PT-BR, EN, ES, FR).

## Recent Changes
- 2026-02-07: KYC Lite Identity Verification System
  - Manual admin review verification: users upload document photo + selfie
  - Documents stored securely in Replit Object Storage with private ACL
  - Verification states: unverified, pending, verified, rejected
  - VerificationSection component on profile page with upload flow (presigned URLs)
  - Admin Verifications tab with approve/reject + document/selfie viewing
  - Access gating: unverified users blocked from creating/joining activities and chat
  - Frontend + backend verification enforcement
  - Verification status badges and banners throughout the app
  - 40+ new i18n keys across 4 languages for verification UI
  - Schema: verificationStatus, documentUrl, selfieUrl, timestamps on pilgrim_profiles
  - API routes: upload-url, submit, status check, admin review, document serving
- 2026-02-07: Invite-Only Access + Block/Report + Terms + Admin Panel + Security
  - Invite-only access system: inviteCodes and inviteRedemptions tables, 8-char hex codes
  - Admin auto-access via ADMIN_EMAIL environment variable
  - InviteGate page: code validation + terms/privacy acceptance before app access
  - Access flow: login → check status → invite gate or suspended screen or app
  - Block/report system: userBlocks and userReports tables, 7 predefined report reasons
  - UserActions component (report + block buttons), ReportModal, BlockConfirmDialog
  - Comprehensive Terms of Use page (/terms) in 4 languages (PT-BR, EN, ES, FR)
  - Admin panel (/admin) with invite management + report handling + user suspension
  - Suspended page for banned users with reason display
  - Security: helmet middleware, express-rate-limit (200/15min general, 20/15min auth)
  - Input sanitization for user-generated text
  - Schema: isAdmin, isSuspended, acceptedTermsAt, termsVersion, privacyVersion on profiles
  - 15+ new API endpoints for invites, blocks, reports, admin, access-status
  - 75+ new i18n keys across 4 languages
- 2026-02-07: Nationality Flags + Spoken Languages
  - Nationality field changed from freeform text to Select dropdown with country codes (ISO 3166-1 alpha-2)
  - Country flags displayed via flagcdn.com CDN images
  - Flags shown on: activity cards (creator), activity detail (creator + participants), ranking page
  - Reusable CountryFlag component at client/src/components/country-flag.tsx
  - Countries constants at client/src/constants/countries.ts
  - New spokenLanguages text array column on pilgrim_profiles
  - Spoken languages multi-select badges on profile page (14 language options)
  - Spoken languages displayed on profile header
  - Social sharing buttons (WhatsApp, Facebook, X/Twitter, Copy Link) on activity detail
  - Delete activity feature (creator-only, with confirmation dialog)
- 2026-02-07: Transport Routes Feature
  - Structured From/To city fields for transport activities
  - Predefined high-demand routes (Madrid→Pamplona, Lisboa→Porto, etc.)
  - Auto-fill from/to when selecting a suggested route
  - Auto-generated title from route if title left empty
  - Validation: departure and arrival must be different cities
  - Transport route display on activity cards and detail pages (From → To)
  - Constants file at client/src/constants/transport-routes.ts for easy expansion
  - Schema fields: transportFrom, transportTo, transportRouteId on activities table
  - i18n translations for all transport labels/errors in 4 languages
- 2026-02-07: User Ranking + Profile Photos + Date Filter
  - Ranking page at /ranking showing pilgrims by average rating
  - Profile photo upload (base64 data URLs, 2MB limit)
  - Date range filter on activities page (From/To date inputs)
  - Dashboard updated with ranking link
- 2026-02-06: Privacy Policy + Domain Verification
  - Privacy policy page at /privacy compliant with LGPD (Brazil), GDPR (EU), and CCPA/CPRA (US)
  - Privacy policy available in 4 languages (PT-BR, EN, ES, FR) matching user's locale
  - Digital Asset Links file at /.well-known/assetlinks.json for Google Play Store TWA verification
  - Footer link to privacy policy on landing page
  - Custom app logo created and integrated in all headers
- 2026-02-06: Rebrand to "Meet Up" + i18n + Sharing/SEO
  - App renamed from "Caminho Companion" to "Meet Up" everywhere
  - Full i18n system with React context, useT() hook, and JSON translation files
  - 4 languages: Portuguese (Brazil), English, Spanish, French
  - Language selector (globe icon) in header and landing page
  - Browser language detection with localStorage persistence
  - All UI text extracted to translation keys across all components
  - Sharing CTA on landing page, copy link button on activity detail
  - Open Graph meta tags for social sharing
  - SEO-friendly meta description and title
- 2026-02-06: Web Push Notifications + BRL Currency
  - Web Push notifications using web-push library + VAPID keys
  - Push subscription management (subscribe/unsubscribe per user)
  - Push notifications on new chat messages to activity participants
  - Service worker v2 with push event listener + notificationclick handler
  - Notification settings UI on profile page (enable/disable/test)
  - Stripe donations switched from EUR to BRL (Brazilian Real)
  - Donate page labels updated to R$ prefix
- 2026-02-06: PWA + Stripe Integration
  - Progressive Web App (manifest.json, service worker, app icons)
  - Installable on mobile devices (Android/iOS)
  - Stripe Checkout for real donations
  - Stripe webhook handler for payment confirmations
  - Success/cancel payment flow pages
  - Session-based donation tracking with stripeSessionId
- 2026-02-06: Initial MVP built with all core features
  - Landing page with Camino hero image
  - User authentication via Replit Auth
  - Pilgrim profiles with travel preferences
  - Activity CRUD (transport, meal, hike, lodging)
  - Smart activity recommendations based on city/date/preferences
  - Interactive Leaflet map with activity pins
  - Chat within activities (polling-based)
  - Star ratings and reviews
  - Seed data with sample pilgrims and activities
  - Camino-themed design with blue/green/beige color palette

## User Preferences
- Mobile-first, responsive design
- Portuguese (Brazilian) as default language, with EN/ES/FR support
- Clean, pilgrimage-themed aesthetic

## Project Architecture
- **Frontend**: React + TypeScript + Tailwind CSS + shadcn/ui
- **Backend**: Express.js + TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **Auth**: Replit Auth (OpenID Connect)
- **Maps**: Leaflet.js with OpenStreetMap tiles
- **Payments**: Stripe Checkout (one-time donations in BRL)
- **Push**: Web Push (web-push library + VAPID keys)
- **i18n**: Custom React context + JSON translation files (pt-BR, en, es, fr)
- **Routing**: wouter (frontend), Express (backend)
- **State**: TanStack React Query
- **PWA**: manifest.json + service worker (sw.js)

### Key Files
- `shared/schema.ts` - All Drizzle schemas (including pushSubscriptions)
- `server/routes.ts` - All API endpoints (including push notification routes)
- `server/storage.ts` - Database operations (DatabaseStorage class)
- `server/stripeClient.ts` - Stripe SDK client + StripeSync setup
- `server/webhookHandlers.ts` - Stripe webhook processing
- `server/index.ts` - Express setup with Stripe init + webhook before express.json()
- `server/seed.ts` - Seed data for demo
- `client/src/App.tsx` - Main app with routing, auth flow, I18nProvider
- `client/src/lib/i18n.tsx` - i18n context, useT hook, language detection
- `client/src/i18n/*.json` - Translation files (pt-BR, en, es, fr)
- `client/src/components/language-selector.tsx` - Language dropdown component
- `client/src/pages/donate.tsx` - Stripe donation checkout page (BRL)
- `client/src/pages/profile.tsx` - Profile + NotificationSettings component
- `client/src/pages/` - All page components
- `client/src/components/` - Reusable components
- `client/public/manifest.json` - PWA manifest
- `client/public/sw.js` - Service worker (caching + push notifications)

### API Endpoints
- `GET/POST /api/profile` - Pilgrim profile CRUD
- `GET /api/activities` - List all activities
- `GET /api/activities/recommended` - Smart recommendations
- `GET /api/activities/mine` - User's activities
- `GET/POST /api/activities/:id` - Activity detail & create
- `POST /api/activities/:id/join` - Join activity
- `POST /api/activities/:id/leave` - Leave activity
- `GET/POST /api/activities/:id/messages` - Chat messages (+ push notify)
- `GET/POST /api/activities/:id/ratings` - Ratings
- `GET /api/stripe/publishable-key` - Stripe publishable key
- `POST /api/donations/checkout` - Create Stripe Checkout session (BRL)
- `GET /api/donations/status/:sessionId` - Check payment status
- `POST /api/stripe/webhook` - Stripe webhook (raw body, before express.json)
- `GET /api/push/vapid-key` - VAPID public key for push subscription
- `POST /api/push/subscribe` - Save push subscription
- `DELETE /api/push/subscribe` - Remove push subscription
- `GET /api/push/status` - Check if user has push subscription
- `POST /api/push/test` - Send test push notification

### Database Tables
- `users` + `sessions` - Auth (managed by Replit Auth)
- `pilgrim_profiles` - Extended user profiles
- `activities` - Activities created by pilgrims
- `activity_participants` - Join table
- `chat_messages` - Chat per activity
- `ratings` - Star ratings per activity
- `donations` - Donation records (with stripeSessionId, stripePaymentStatus)
- `push_subscriptions` - Web Push subscriptions (userId, endpoint, p256dh, auth)
- `stripe.*` - Stripe sync tables (managed by stripe-replit-sync)
